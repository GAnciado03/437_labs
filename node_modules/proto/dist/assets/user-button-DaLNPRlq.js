const d="theme",a=new WeakSet;function s(t){const e=document.body.classList.contains("dark");t.setAttribute("aria-pressed",String(e));const n=t.getAttribute("data-label-on")||"Dark: On",o=t.getAttribute("data-label-off")||"Dark: Off";t.textContent=e?n:o}function r(t){if(t)return s(t);document.querySelectorAll("[data-theme-button]").forEach(s)}function u(t){document.body.classList.toggle("dark",t==="dark"),r()}function h(){const t=localStorage.getItem(d);return t==="dark"||t==="light"?t:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function f(t){localStorage.setItem(d,t),u(t)}document.body.addEventListener("theme-toggle",()=>{const t=document.body.classList.contains("dark")?"light":"dark";f(t)});function l(t){if(a.has(t)){r(t);return}a.add(t),r(t)}function m(t=document){t.querySelectorAll("[data-theme-button]").forEach(l)}function g(){new MutationObserver(e=>{e.forEach(({addedNodes:n})=>{n.forEach(o=>{o instanceof HTMLElement&&(o.matches("[data-theme-button]")&&l(o),o.querySelectorAll&&m(o))})})}).observe(document.body,{childList:!0,subtree:!0})}function b(t){t.target instanceof HTMLElement&&t.target.closest("[data-theme-button]")&&(t.preventDefault(),document.body.dispatchEvent(new CustomEvent("theme-toggle",{bubbles:!0})))}u(h());const c=()=>{m(),g(),document.addEventListener("click",b,{capture:!0}),r()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();function p(){try{return!!localStorage.getItem("token")}catch{return!1}}function i(){const t=(location.pathname||"").toLowerCase();if(t==="/"||t.endsWith("/index.html")||t.endsWith("index.html")||t.endsWith("/user.html")||t.endsWith("user.html")||document.querySelector("#floating-user-button"))return;const e=document.createElement("a");e.id="floating-user-button";const n=p();e.href=n?"user.html":"login.html",e.setAttribute("aria-label",n?"User":"Login"),e.className="mono",e.textContent=n?"User":"Login",Object.assign(e.style,{position:"fixed",top:"var(--space-3, 1rem)",right:"var(--space-3, 1rem)",padding:".35rem .6rem",background:"var(--color-surface)",color:"var(--color-text)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-sm, 6px)",textDecoration:"none",fontWeight:"600",boxShadow:"var(--shadow-sm, 0 1px 2px rgba(0,0,0,.08))",zIndex:"1000"}),document.body.appendChild(e)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i();
